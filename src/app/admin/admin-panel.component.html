<!-- src/app/admin/admin-panel.component.html - VERSIÓN CORREGIDA SIN ERRORES -->
<div class="admin-container">
  <!-- Header -->
  <header class="admin-header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo-section">
          <mat-icon class="admin-logo-icon">admin_panel_settings</mat-icon>
          <div class="logo-text">
            <h1>Panel de Administración</h1>
            <span>Gestión completa del sistema</span>
          </div>
          <div class="admin-badge">
            <span>ADMIN</span>
          </div>
        </div>
      </div>
      
      <div class="header-right">
        <div class="admin-user-info">
          <div class="user-avatar">
            <mat-icon>shield</mat-icon>
          </div>
          <div class="user-details">
            <span class="user-name">{{ currentUser()?.displayName }}</span>
            <span class="user-role">ADMINISTRADOR</span>
          </div>
        </div>
        
        <button mat-icon-button (click)="goToDashboard()" class="nav-button" title="Ir al Dashboard">
          <mat-icon>dashboard</mat-icon>
        </button>
        
        <button mat-icon-button [matMenuTriggerFor]="adminMenu" class="menu-button">
          <mat-icon>more_vert</mat-icon>
        </button>
        
        <mat-menu #adminMenu="matMenu">
          <button mat-menu-item (click)="goToDashboard()">
            <mat-icon>dashboard</mat-icon>
            Dashboard
          </button>
          <button mat-menu-item (click)="refreshData()">
            <mat-icon>refresh</mat-icon>
            Actualizar Datos
          </button>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            Cerrar Sesión
          </button>
        </mat-menu>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="admin-main">
    <!-- Welcome Section -->
    <section class="welcome-section">
      <h2 class="welcome-title">Centro de Control Administrativo</h2>
      <p class="welcome-subtitle">Gestiona usuarios, módulos y configuraciones del sistema</p>
    </section>

    <!-- Stats Grid -->
    <section class="stats-section">
      <div class="stats-grid">
        <!-- Total Users -->
        <div class="stat-card users-card">
          <div class="stat-icon">
            <mat-icon>group</mat-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ totalUsers }}</div>
            <div class="stat-label">Usuarios Totales</div>
          </div>
        </div>

        <!-- Active Users -->
        <div class="stat-card active-card">
          <div class="stat-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ activeUsers }}</div>
            <div class="stat-label">Usuarios Activos</div>
          </div>
        </div>

        <!-- Total Modules -->
        <div class="stat-card modules-card">
          <div class="stat-icon">
            <mat-icon>apps</mat-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ totalModules }}</div>
            <div class="stat-label">Módulos Activos</div>
          </div>
        </div>

        <!-- Admin Users -->
        <div class="stat-card admins-card">
          <div class="stat-icon">
            <mat-icon>security</mat-icon>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{ adminUsers }}</div>
            <div class="stat-label">Administradores</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Quick Actions -->
    <section class="actions-section">
      <div class="section-header">
        <h3>Acciones Rápidas</h3>
        <p>Gestión del sistema y usuarios</p>
      </div>
      
      <div class="actions-grid">
        <button class="action-button primary" (click)="addUser()" title="Crear nuevo usuario en el sistema">
          <mat-icon>person_add</mat-icon>
          <span>Agregar Usuario</span>
        </button>
        
        <button class="action-button secondary" (click)="manageRoles()" title="Gestionar roles y permisos">
          <mat-icon>admin_panel_settings</mat-icon>
          <span>Gestionar Roles</span>
        </button>
        
        <button class="action-button" (click)="manageModules()" title="Configurar módulos del sistema">
          <mat-icon>apps</mat-icon>
          <span>Gestionar Módulos</span>
        </button>
        
        <button class="action-button" (click)="viewLogs()" title="Ver registros de actividad">
          <mat-icon>list_alt</mat-icon>
          <span>Ver Logs</span>
        </button>
        
        <button class="action-button" (click)="systemSettings()" title="Configuración general del sistema">
          <mat-icon>settings</mat-icon>
          <span>Configuración</span>
        </button>
        
        <button class="action-button" (click)="exportData()" title="Exportar datos de usuarios">
          <mat-icon>download</mat-icon>
          <span>Exportar Datos</span>
        </button>
      </div>
    </section>

    <!-- Users Table -->
    <section class="table-section">
      <div class="section-header">
        <h3>Usuarios Recientes</h3>
        <p>Últimos usuarios que han accedido al sistema</p>
      </div>
      
      <div class="table-container">
        <div class="table-wrapper">
          <table class="users-table">
            <thead>
              <tr>
                <th>Usuario</th>
                <th>Rol</th>
                <th>Estado</th>
                <th>Módulos Asignados</th>
                <th>Último Acceso</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of displayedUsers; trackBy: trackByUid" class="table-row">
                <td class="user-cell">
                  <div class="user-info">
                    <div class="user-avatar-small" [style.background]="getUserAvatarColor(user.email)">
                      <mat-icon>{{ getUserIcon(user.role) }}</mat-icon>
                    </div>
                    <div class="user-details-table">
                      <span class="user-email">{{ user.email }}</span>
                      <span class="user-name-small">{{ user.displayName || 'Sin nombre' }}</span>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="role-badge" [ngClass]="'role-' + user.role">
                    <mat-icon class="role-icon">{{ getRoleIcon(user.role) }}</mat-icon>
                    <span>{{ user.role.toUpperCase() }}</span>
                  </div>
                </td>
                <td>
                  <div class="status-badge" [ngClass]="user.isActive ? 'status-active' : 'status-inactive'">
                    <mat-icon>{{ user.isActive ? 'check_circle' : 'cancel' }}</mat-icon>
                    <span>{{ user.isActive ? 'ACTIVO' : 'INACTIVO' }}</span>
                  </div>
                </td>
                <td class="modules-cell">
                  <div class="modules-list" *ngIf="getUserModules(user.email)?.length; else noModules">
                    <mat-chip 
                      *ngFor="let module of getUserModules(user.email)?.slice(0, 3)" 
                      class="module-chip">
                      <mat-icon matChipAvatar>{{ getModuleIcon(module) }}</mat-icon>
                      {{ getModuleName(module) }}
                    </mat-chip>
                    <span *ngIf="getUserModules(user.email).length > 3" class="more-modules">
                      +{{ getUserModules(user.email).length - 3 }} más
                    </span>
                  </div>
                  <ng-template #noModules>
                    <span class="no-modules">Sin módulos</span>
                  </ng-template>
                </td>
                <td class="date-cell">
                  <div class="date-info">
                    <span class="date-text">{{ formatDate(user.lastLogin) }}</span>
                    <span class="date-relative">{{ getRelativeTime(user.lastLogin) }}</span>
                  </div>
                </td>
                <td>
                  <button mat-icon-button [matMenuTriggerFor]="userMenu" class="action-menu-button">
                    <mat-icon>more_vert</mat-icon>
                  </button>
                  <mat-menu #userMenu="matMenu">
                    <button mat-menu-item (click)="viewUserDetails(user)">
                      <mat-icon>visibility</mat-icon>
                      Ver Detalles
                    </button>
                    <button mat-menu-item (click)="editUser(user)">
                      <mat-icon>edit</mat-icon>
                      Editar Usuario
                    </button>
                    <button mat-menu-item (click)="resetUserPassword(user)">
                      <mat-icon>lock_reset</mat-icon>
                      Restablecer Contraseña
                    </button>
                    <button mat-menu-item (click)="toggleUserStatus(user)">
                      <mat-icon>{{ user.isActive ? 'block' : 'check_circle' }}</mat-icon>
                      {{ user.isActive ? 'Desactivar' : 'Activar' }}
                    </button>
                    <button mat-menu-item (click)="assignModules(user)" class="assign-modules">
                      <mat-icon>apps</mat-icon>
                      Asignar Módulos
                    </button>
                  </mat-menu>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Table Actions -->
      <div class="table-actions" *ngIf="users.length > 0">
        <div class="table-info">
          <span>Mostrando {{ displayedUsers.length }} de {{ totalUsers }} usuarios</span>
        </div>
        <div class="table-buttons">
          <button mat-button (click)="loadMoreUsers()" *ngIf="displayedUsers.length < users.length">
            <mat-icon>expand_more</mat-icon>
            Ver Más Usuarios
          </button>
          <button mat-raised-button color="primary" (click)="addUser()">
            <mat-icon>person_add</mat-icon>
            Nuevo Usuario
          </button>
        </div>
      </div>
      
      <!-- Estado cuando no hay usuarios -->
      <div class="empty-state" *ngIf="users.length === 0 && !isLoading">
        <mat-icon class="empty-icon">people_outline</mat-icon>
        <h3>No hay usuarios registrados</h3>
        <p>Comienza agregando el primer usuario al sistema</p>
        <button mat-raised-button color="primary" (click)="addUser()">
          <mat-icon>person_add</mat-icon>
          Agregar Primer Usuario
        </button>
      </div>
      
      <!-- Estado de carga -->
      <div class="loading-state" *ngIf="isLoading">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Cargando usuarios...</p>
      </div>
    </section>

    <!-- Sistema de Módulos Info -->
    <section class="info-section" *ngIf="totalModules > 0">
      <div class="info-header">
        <mat-icon class="info-icon">info</mat-icon>
        <h4>Sistema Modular</h4>
      </div>
      <p>
        El sistema cuenta con <strong>{{ totalModules }} módulos activos</strong> que pueden ser asignados a los usuarios según sus roles y responsabilidades. 
        Cada módulo proporciona funcionalidades específicas y puede tener permisos granulares.
      </p>
      <div class="popular-modules" *ngIf="getPopularModules()?.length">
        <span class="label">Módulos más utilizados:</span>
        <mat-chip-set>
          <mat-chip *ngFor="let module of getPopularModules()">
            <mat-icon matChipAvatar>{{ module.icon }}</mat-icon>
            {{ module.name }}
          </mat-chip>
        </mat-chip-set>
      </div>
    </section>
  </main>
</div>