<!-- dashboard.component.html - DISEÑO COMPACTO CON TAILWIND -->
<div class="dashboard-container">

  <!-- ============================================
       HEADER COMPACTO
       ============================================ -->
  <header class="bg-white rounded-2xl border border-slate-200 shadow-sm p-4 mb-5 animate-fadeIn">
    <div class="flex items-center justify-between gap-4 flex-wrap">

      <!-- Left Section -->
      <div class="flex items-center gap-3">
        <div class="header-icon-box">
          <mat-icon>dashboard</mat-icon>
        </div>
        <div>
          <h1 class="text-lg font-bold text-slate-800">¡Bienvenido de nuevo!</h1>
          @if (!loading() && userDashboard()) {
            <p class="text-xs text-slate-500 flex items-center gap-1.5">
              <span class="status-dot" [class.recent]="isRecentSession()"></span>
              Última sesión: {{ getLastSession() }}
            </p>
          } @else {
            <p class="text-xs text-slate-500">Cargando información...</p>
          }
        </div>
      </div>

      <!-- Right Section - Stats & Actions -->
      <div class="hidden md:flex items-center gap-3">
        @if (!loading() && userDashboard()) {
          <div class="stat-chip">
            <span class="stat-value">{{ userDashboard()!.userStats.totalPermissions }}</span>
            <span class="stat-label">Permisos</span>
          </div>
          <div class="stat-chip">
            <span class="stat-value">{{ userDashboard()!.userStats.totalModules }}</span>
            <span class="stat-label">Módulos</span>
          </div>
        }

        <!-- Notification Button -->
        <button type="button"
                class="notification-btn"
                (click)="goToNotifications()"
                title="Notificaciones">
          <mat-icon>notifications</mat-icon>
          @if (getNotificationCount() > 0) {
            <span class="notification-badge">{{ getNotificationCount() }}</span>
          }
        </button>
      </div>
    </div>
  </header>

  <!-- ============================================
       LOADING STATE
       ============================================ -->
  @if (loading()) {
    <div class="empty-state">
      <mat-spinner diameter="40"></mat-spinner>
      <p class="mt-3 text-sm text-slate-600 font-medium">Cargando tu dashboard...</p>
    </div>
  }

  <!-- ============================================
       ERROR STATE
       ============================================ -->
  @if (error() && !loading()) {
    <div class="empty-state">
      <div class="error-icon-box">
        <mat-icon>error_outline</mat-icon>
      </div>
      <h3 class="text-base font-semibold text-slate-800 mt-4 mb-2">Error al cargar</h3>
      <p class="text-sm text-slate-600 mb-5">{{ error() }}</p>
      <button type="button" class="btn-primary" (click)="refreshData()">
        <mat-icon>refresh</mat-icon>
        Reintentar
      </button>
    </div>
  }

  <!-- ============================================
       DASHBOARD CONTENT
       ============================================ -->
  @if (!loading() && !error() && userDashboard()) {
    <div class="animate-fadeInUp">

      <!-- ============================================
           QUICK ACTIONS
           ============================================ -->
      <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
        @for (action of quickActions(); track action.id; let i = $index) {
          <div class="action-card"
               [style.animation-delay]="(i * 0.05) + 's'"
               (click)="executeQuickAction(action)">

            <!-- Icon -->
            <div class="action-icon-box">
              <mat-icon>{{ action.icon }}</mat-icon>
              @if (action.badge) {
                <span class="action-badge">{{ action.badge }}</span>
              }
            </div>

            <!-- Content -->
            <div class="action-content">
              <h3 class="action-title">{{ action.title }}</h3>
              <p class="action-description">{{ action.description }}</p>
            </div>

            <!-- Arrow -->
            <mat-icon class="action-arrow">chevron_right</mat-icon>
          </div>
        }
      </section>

      <!-- ============================================
           PANEL DE CONTROL
           ============================================ -->
      @defer (on viewport) {
        <section class="content-card">
          <div class="card-header">
            <div class="card-icon cyan">
              <mat-icon>insights</mat-icon>
            </div>
            <div>
              <h2 class="card-title">Tu Panel de Control</h2>
              <p class="card-subtitle">Resumen de tu cuenta y accesos</p>
            </div>
          </div>

          <!-- Key Metrics Grid -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-6">
            @for (metric of keyMetrics(); track metric.label) {
              <div class="metric-card">
                <div class="metric-header">
                  <mat-icon class="metric-icon">{{ metric.icon }}</mat-icon>
                  <span class="metric-label">{{ metric.label }}</span>
                </div>
                <div class="metric-value">{{ metric.value }}</div>
                <div class="metric-change">{{ metric.change }}</div>
              </div>
            }
          </div>

          <!-- Permisos Section -->
          <div class="mb-5">
            <h3 class="section-title">
              <mat-icon>verified</mat-icon>
              Tus Permisos
            </h3>
            <div class="flex flex-wrap gap-2">
              @for (permission of userDashboard()!.userInfo.permissions; track permission) {
                <div class="tag-item">
                  <mat-icon>{{ getPermissionIcon(permission) }}</mat-icon>
                  {{ getPermissionLabel(permission) }}
                </div>
              }
              @if (userDashboard()!.userInfo.permissions.length === 0) {
                <div class="tag-item warning">
                  <mat-icon>warning</mat-icon>
                  Sin permisos asignados
                </div>
              }
            </div>
          </div>

          <!-- Módulos Section -->
          <div>
            <h3 class="section-title">
              <mat-icon>apps</mat-icon>
              Módulos Activos
            </h3>
            <div class="flex flex-wrap gap-2">
              @for (module of userDashboard()!.userInfo.modules; track module) {
                <div class="tag-item">
                  <mat-icon>dashboard</mat-icon>
                  {{ module }}
                </div>
              }
              @if (userDashboard()!.userInfo.modules.length === 0) {
                <div class="tag-item warning">
                  <mat-icon>warning</mat-icon>
                  Sin módulos asignados
                </div>
              }
            </div>
          </div>
        </section>
      } @placeholder {
        <div class="content-card animate-pulse">
          <div class="h-5 bg-slate-200 rounded w-40 mb-5"></div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="h-20 bg-slate-100 rounded-xl"></div>
            <div class="h-20 bg-slate-100 rounded-xl"></div>
          </div>
        </div>
      }

    </div>
  }
</div>
