<!-- dashboard.component.html - REFACTORIZADO CON TAILWIND + MATERIAL -->
<div class="max-w-[1400px] mx-auto p-5">
  
  <!-- ============================================
       HEADER - USANDO CLASES GLOBALES
       ============================================ -->
  <header class="page-header">
    <div class="flex items-center justify-between gap-5 flex-wrap">
      
      <!-- Left Section -->
      <div class="flex items-center gap-4">
        <div class="header-icon-container">
          <mat-icon>dashboard</mat-icon>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-slate-800 mb-1">隆Bienvenido de nuevo! </h1>
          @if (!loading() && userDashboard()) {
            <p class="text-sm text-slate-600 flex items-center gap-2 font-medium">
              <span class="status-dot" [class.recent]="isRecentSession()"></span>
              ltima sesi贸n: {{ getLastSession() }}
            </p>
          }
        </div>
      </div>
      
      <!-- Right Section -->
      <div class="flex items-center gap-3 flex-wrap">
      
        <!-- Action Buttons -->
        <button mat-icon-button
                class="icon-btn"
                [matBadge]="getNotificationCount()"
                [matBadgeHidden]="getNotificationCount() === 0"
                matBadgeColor="warn"
                matTooltip="Notificaciones"
                aria-label="Ver notificaciones"
                (click)="goToNotifications()">
          <mat-icon>notifications</mat-icon>
        </button>        
       
      </div>
    </div>
  </header>

  <!-- ============================================
       LOADING STATE
       ============================================ -->
  @if (loading()) {
    <div class="empty-state">
      <mat-spinner diameter="50"></mat-spinner>
      <p class="mt-4 text-slate-600 font-medium">Cargando tu dashboard...</p>
    </div>
  }

  <!-- ============================================
       ERROR STATE
       ============================================ -->
  @if (error() && !loading()) {
    <div class="empty-state">
      <mat-icon class="text-red-500 text-5xl mb-4">error_outline</mat-icon>
      <h3 class="text-lg font-semibold text-slate-800 mb-2">Error al cargar</h3>
      <p class="text-slate-600 mb-6">{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="refreshData()">
        <mat-icon>refresh</mat-icon>
        Reintentar
      </button>
    </div>
  }

  <!-- ============================================
       DASHBOARD CONTENT
       ============================================ -->
  @if (!loading() && !error() && userDashboard()) {
    <div>

    <!-- ============================================
         QUICK ACTIONS - CON TAILWIND
         ============================================ -->
    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      @for (action of quickActions(); track action.id) {
        <div class="card-corporate cursor-pointer group relative"
             (click)="executeQuickAction(action)">

          <!-- Gradient top bar on hover -->
          <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 to-blue-600 scale-x-0 group-hover:scale-x-100 transition-transform duration-300 rounded-t-2xl"></div>

          <!-- Icon -->
          <div class="header-icon-container mb-4 relative">
            <mat-icon>{{ action.icon }}</mat-icon>
            @if (action.badge) {
              <span class="absolute -top-1.5 -right-1.5 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-lg border-2 border-white min-w-[22px] text-center">
                {{ action.badge }}
              </span>
            }
          </div>

          <!-- Content -->
          <h3 class="text-base font-semibold text-slate-800 mb-1.5">{{ action.title }}</h3>
          <p class="text-sm text-slate-600 leading-snug">{{ action.description }}</p>
        </div>
      }
    </section>

    <!-- ============================================
         MAIN GRID - 2 COLUMNAS
         ============================================ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
      
      <!-- ============================================
           LEFT COLUMN - OVERVIEW (2/3 width)
           ============================================ -->
      <section class="lg:col-span-2 bg-white rounded-2xl p-8 border border-slate-200 shadow-soft">
        <h2 class="flex items-center gap-2.5 text-xl font-bold text-slate-800 mb-6">
          <mat-icon class="text-blue-500">dashboard</mat-icon>
          Tu Panel de Control
        </h2>
        
        <!-- Key Metrics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
          @for (metric of keyMetrics(); track metric.label) {
            <div class="bg-slate-50 p-5 rounded-xl border border-slate-200 hover:bg-white hover:border-blue-500 hover:-translate-y-0.5 transition-all duration-200 cursor-pointer">
              <div class="flex items-center gap-2 text-xs text-slate-600 uppercase font-semibold mb-2.5 tracking-wider">
                <mat-icon class="!text-base text-blue-500">{{ metric.icon }}</mat-icon>
                {{ metric.label }}
              </div>
              <div class="text-3xl font-bold text-slate-800 mb-1.5 leading-none">
                {{ metric.value }}
              </div>
              <div class="text-xs text-green-600 font-semibold">
                {{ metric.change }}
              </div>
            </div>
          }
        </div>

        <!-- Permisos Section -->
        <div class="mb-8">
          <h3 class="flex items-center gap-2 text-base font-semibold text-slate-800 mb-3.5">
            <mat-icon class="!text-xl text-blue-500">verified</mat-icon>
            Tus Permisos
          </h3>
          <div class="flex flex-wrap gap-2.5">
            @for (permission of userDashboard()!.userInfo.permissions; track permission) {
              <div class="bg-slate-50 px-4 py-2.5 rounded-lg text-sm text-slate-700 border border-slate-200 flex items-center gap-1.5 font-medium hover:bg-white hover:border-blue-500 hover:-translate-y-0.5 transition-all duration-200">
                <mat-icon class="!text-lg text-blue-500">{{ getPermissionIcon(permission) }}</mat-icon>
                {{ getPermissionLabel(permission) }}
              </div>
            }
            @if (userDashboard()!.userInfo.permissions.length === 0) {
              <div class="bg-amber-50 text-amber-700 px-4 py-2.5 rounded-lg text-sm font-medium border border-amber-200">
                Sin permisos asignados
              </div>
            }
          </div>
        </div>

        <!-- M贸dulos Section -->
        <div>
          <h3 class="flex items-center gap-2 text-base font-semibold text-slate-800 mb-3.5">
            <mat-icon class="!text-xl text-blue-500">apps</mat-icon>
            M贸dulos Activos
          </h3>
          <div class="flex flex-wrap gap-2.5">
            @for (module of userDashboard()!.userInfo.modules; track module) {
              <div class="bg-slate-50 px-4 py-2.5 rounded-lg text-sm text-slate-700 border border-slate-200 flex items-center gap-1.5 font-medium hover:bg-white hover:border-blue-500 hover:-translate-y-0.5 transition-all duration-200">
                <mat-icon class="!text-lg text-blue-500">dashboard</mat-icon>
                {{ module }}
              </div>
            }
            @if (userDashboard()!.userInfo.modules.length === 0) {
              <div class="bg-amber-50 text-amber-700 px-4 py-2.5 rounded-lg text-sm font-medium border border-amber-200">
                Sin m贸dulos asignados
              </div>
            }
          </div>
        </div>
      </section>

      <!-- ============================================
           RIGHT COLUMN - ACTIVIDAD RECIENTE (1/3 width)
           ============================================ -->
      <section class="bg-white rounded-2xl p-8 border border-slate-200 shadow-soft">
        <h2 class="flex items-center gap-2.5 text-xl font-bold text-slate-800 mb-6">
          <mat-icon class="text-blue-500">history</mat-icon>
          Actividad Reciente
        </h2>

        @if (recentActivities().length > 0) {
          <div class="space-y-5">
            @for (activity of recentActivities(); track activity.id; let last = $last) {
              <div class="relative">

                <!-- Timeline line -->
                @if (!last) {
                  <div class="absolute left-5 top-12 w-0.5 h-full bg-gradient-to-b from-slate-200 to-transparent"></div>
                }

                <!-- Activity item -->
                <div class="flex gap-4 relative z-10">
                  <!-- Icon wrapper - Siempre tiene fondo azul por defecto -->
                  <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white flex-shrink-0 activity-icon-primary"
                       [class.activity-icon-success]="getActivityColor(activity.type) === 'accent'"
                       [class.activity-icon-warning]="getActivityColor(activity.type) === 'warn'">
                    <mat-icon class="!text-xl">{{ getActionIcon(activity.type) }}</mat-icon>
                  </div>

                  <!-- Content -->
                  <div class="flex-1 pt-1.5">
                    <div class="font-semibold text-sm text-slate-800 leading-snug mb-1">
                      {{ activity.description }}
                    </div>
                    <div class="text-xs text-slate-500 font-medium">
                      {{ getRelativeTime(activity.timestamp) }}
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        }

        @if (recentActivities().length === 0) {
          <div class="text-center py-12">
            <mat-icon class="!text-5xl text-slate-300 mb-3">inbox</mat-icon>
            <p class="text-sm text-slate-500">No hay actividad reciente</p>
          </div>
        }
      </section>
    </div>

    <!-- ============================================
         INSIGHTS - INFORMACIN CONTEXTUAL
         ============================================ -->
    <section class="bg-white rounded-2xl p-8 border border-slate-200 shadow-soft">
      <!-- Contact Info -->
      <div class="bg-slate-50 p-6 rounded-xl border border-slate-200">
        <h4 class="flex items-center gap-2 text-base font-semibold text-slate-800 mb-4">
          <mat-icon class="!text-xl text-blue-500">email</mat-icon>
          Contacto
        </h4>
        <p class="text-sm text-slate-700 mb-2">
          <strong class="font-semibold text-slate-800">Email:</strong> {{ userDashboard()!.userInfo.email }}
        </p>
        <p class="text-xs text-slate-500 leading-relaxed mt-4 pt-4 border-t border-slate-200">
          驴Necesitas ayuda? Contacta al administrador del sistema o revisa la documentaci贸n en el panel de configuraci贸n.
        </p>
      </div>
    </section>

    </div>
  }
</div>