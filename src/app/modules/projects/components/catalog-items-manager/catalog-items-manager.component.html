<!-- catalog-items-manager.component.html - DISEÑO COMPACTO BLUE -->

<div class="dialog-container">

  <!-- ========== HEADER ========== -->
  <div class="dialog-header">
    <div class="flex items-center gap-3">
      <div class="header-icon-box">
        <mat-icon>settings</mat-icon>
      </div>
      <div>
        <h2>Administrar Catálogo de Items</h2>
        <p>Gestiona los items reutilizables para tus estimados</p>
      </div>
    </div>
    <button type="button" class="close-btn" (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- ========== CONTENT ========== -->
  <div class="dialog-content">

    <!-- Formulario Crear/Editar -->
    <div class="form-section">
      <div class="section-header">
        <mat-icon>{{ isEditMode() ? 'edit' : 'add_circle' }}</mat-icon>
        <span>{{ isEditMode() ? 'Editar Item' : 'Agregar Nuevo Item' }}</span>
      </div>

      <form [formGroup]="itemForm" (ngSubmit)="saveItem()" class="space-y-3">
        <!-- Nombre -->
        <div class="form-group">
          <label class="form-label required">
            <mat-icon>label</mat-icon>
            Nombre del Item
          </label>
          <input type="text"
                 formControlName="name"
                 placeholder="Ej: Instalación de piscina"
                 class="form-input"
                 [class.error]="itemForm.get('name')?.invalid && itemForm.get('name')?.touched">
          @if (itemForm.get('name')?.invalid && itemForm.get('name')?.touched) {
            <p class="form-error">El nombre es requerido (mínimo 3 caracteres)</p>
          }
        </div>

        <!-- Descripción -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>notes</mat-icon>
            Descripción <span class="optional">(Opcional)</span>
          </label>
          <textarea formControlName="description"
                    rows="2"
                    placeholder="Descripción detallada del item (opcional)..."
                    class="form-textarea"></textarea>
        </div>

        <!-- Botones -->
        <div class="form-actions">
          @if (isEditMode()) {
            <button type="button" class="btn-cancel" (click)="resetForm()">
              <mat-icon>cancel</mat-icon>
              <span>Cancelar</span>
            </button>
          }
          <button type="submit" class="btn-primary" [disabled]="itemForm.invalid || isLoading()">
            <mat-icon>{{ isEditMode() ? 'save' : 'add_circle' }}</mat-icon>
            <span>{{ isEditMode() ? 'Actualizar' : 'Agregar' }}</span>
          </button>
        </div>
      </form>
    </div>

    <!-- Lista de Items -->
    <div class="list-section">
      <div class="list-header">
        <div class="list-title">
          <mat-icon>inventory</mat-icon>
          <span>Items del Catálogo ({{ filteredItems.length }})</span>
        </div>

        <!-- Búsqueda -->
        <div class="search-box">
          <mat-icon>search</mat-icon>
          <input type="text"
                 [value]="searchTerm()"
                 (input)="onSearchChange($event)"
                 placeholder="Buscar items...">
        </div>
      </div>

      <!-- Items Grid -->
      @if (isLoading()) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>Cargando items...</p>
        </div>
      } @else if (filteredItems.length === 0) {
        <div class="empty-state">
          <mat-icon>inventory_2</mat-icon>
          <p class="title">No hay items en el catálogo</p>
          <p class="hint">Agrega items usando el formulario de arriba</p>
        </div>
      } @else {
        <div class="items-grid">
          @for (item of filteredItems; track item.id) {
            <div class="item-card">
              <div class="item-content">
                <h4>{{ item.name }}</h4>
                @if (item.description) {
                  <p>{{ item.description }}</p>
                }
              </div>
              <div class="item-actions">
                <button type="button" class="action-btn edit" (click)="editItem(item)" title="Editar">
                  <mat-icon>edit</mat-icon>
                </button>
                <button type="button" class="action-btn delete" (click)="deleteItem(item)" title="Eliminar">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          }
        </div>
      }
    </div>

  </div>

  <!-- ========== FOOTER ========== -->
  <div class="dialog-footer">
    <button type="button" class="btn-close" (click)="close()">
      <mat-icon>close</mat-icon>
      <span>Cerrar</span>
    </button>
  </div>

</div>
