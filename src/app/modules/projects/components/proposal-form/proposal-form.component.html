<!-- proposal-form.component.html - DISEÑO COMPACTO BLUE -->

<div class="form-container">

  <!-- ========== HEADER COMPACTO ========== -->
  <header class="bg-white rounded-2xl border border-slate-200 shadow-sm p-4 mb-5 animate-fadeIn">
    <div class="flex items-center justify-between gap-4 flex-wrap">

      <!-- Left: Back + Icon + Title -->
      <div class="flex items-center gap-3">
        <button type="button" class="back-btn" (click)="cancel()" title="Volver">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="header-icon-box blue">
          <mat-icon>{{ isEditMode() ? 'edit' : 'add_circle' }}</mat-icon>
        </div>
        <div>
          <h1 class="text-lg font-bold text-slate-800">
            {{ (isEditMode() ? 'projects.proposal.editEstimate' : 'projects.proposal.newEstimate') | translate }}
          </h1>
          <p class="text-xs text-slate-500">{{ 'projects.proposal.completeInformation' | translate }}</p>
        </div>
      </div>

      <!-- Right: Language + Actions -->
      <div class="flex items-center gap-2 flex-wrap">
        <!-- Selector de Idioma -->
        <div class="language-selector">
          <mat-icon>translate</mat-icon>
          <select
            [value]="proposalForm.get('language')?.value || 'es'"
            (change)="onLanguageChangeFromHeader($any($event.target).value)">
            <option value="es">ES Español</option>
            <option value="en">EN English</option>
          </select>
        </div>

        <button type="button" class="btn-cancel" (click)="cancel()" [disabled]="isLoading()">
          <mat-icon>close</mat-icon>
          <span class="hidden sm:inline">{{ 'common.cancel' | translate }}</span>
        </button>

        <button type="button" class="btn-secondary" (click)="save(true)" [disabled]="isLoading()">
          @if (isLoading()) {
            <div class="btn-spinner"></div>
          } @else {
            <mat-icon>drafts</mat-icon>
          }
          <span class="hidden sm:inline">{{ 'common.saveDraft' | translate }}</span>
        </button>

        <button type="button" class="btn-primary" (click)="save(false)" [disabled]="isLoading()">
          @if (isLoading()) {
            <div class="btn-spinner"></div>
          } @else {
            <mat-icon>save</mat-icon>
          }
          <span>{{ (isEditMode() ? 'common.update' : 'common.saveAndFinish') | translate }}</span>
        </button>
      </div>

    </div>
  </header>

  <form [formGroup]="proposalForm" class="space-y-4">

    <!-- ========== INFORMACIÓN DEL CLIENTE ========== -->
    <div class="form-section animate-fadeIn" style="animation-delay: 0.05s">
      <div class="section-header">
        <div class="section-icon blue">
          <mat-icon>person</mat-icon>
        </div>
        <div>
          <h2>{{ 'projects.proposal.client_info.title' | translate }}</h2>
          <p>{{ 'projects.proposal.client_info.selectAndVerify' | translate }}</p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Cliente Autocomplete -->
        <div class="form-group">
          <label class="form-label required">
            <mat-icon>search</mat-icon>
            {{ 'projects.proposal.client_info.client' | translate }}
          </label>
          <div class="flex gap-1.5">
            <div class="relative flex-1">
              <input
                type="text"
                [value]="clientSearchTerm()"
                (input)="onClientSearchChange($event)"
                [matAutocomplete]="autoClients"
                [placeholder]="'projects.proposal.client_info.searchClient' | translate"
                class="form-input w-full pl-10">
              <mat-icon class="input-icon-left">search</mat-icon>

              <mat-autocomplete #autoClients="matAutocomplete" (optionSelected)="selectClient($event.option.value)">
                @if (filteredClients().length === 0) {
                  <mat-option disabled>
                    <span class="text-slate-400 text-sm">{{ 'projects.proposal.client_info.noClientsFound' | translate }}</span>
                  </mat-option>
                }
                @for (client of filteredClients(); track client.id) {
                  <mat-option [value]="client">
                    <div class="flex flex-col py-1">
                      <span class="font-semibold text-slate-800">{{ getClientName(client) }}</span>
                      @if (getClientEmail(client) || getClientPhone(client)) {
                        <span class="text-xs text-slate-500">
                          {{ getClientEmail(client) }}
                          @if (getClientEmail(client) && getClientPhone(client)) { • }
                          {{ getClientPhone(client) }}
                        </span>
                      }
                    </div>
                  </mat-option>
                }
              </mat-autocomplete>
            </div>
            <button type="button" class="btn-icon blue" (click)="openAddClientDialog()" title="{{ 'projects.proposal.client_info.addNewClient' | translate }}">
              <mat-icon>add</mat-icon>
            </button>
          </div>
          @if (shouldShowError('ownerId')) {
            <p class="form-error">{{ 'projects.proposal.client_info.validation.clientRequired' | translate }}</p>
          }
        </div>

        <!-- Nombre del Cliente -->
        <div class="form-group">
          <label class="form-label required">
            <mat-icon>badge</mat-icon>
            {{ 'projects.proposal.client_info.name' | translate }}
          </label>
          <input type="text" formControlName="ownerName" readonly
                 class="form-input readonly" [class.error]="shouldShowError('ownerName')"
                 [placeholder]="'projects.proposal.client_info.namePlaceholder' | translate">
          @if (shouldShowError('ownerName')) {
            <p class="form-error">{{ 'projects.proposal.client_info.validation.nameRequired' | translate }}</p>
          }
        </div>

        <!-- Email -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>email</mat-icon>
            {{ 'projects.proposal.client_info.email' | translate }}
          </label>
          <input type="email" formControlName="ownerEmail" readonly
                 class="form-input readonly" [class.error]="shouldShowError('ownerEmail')"
                 [placeholder]="'projects.proposal.client_info.emailPlaceholder' | translate">
          @if (shouldShowError('ownerEmail')) {
            <p class="form-error">{{ 'projects.proposal.client_info.validation.emailInvalid' | translate }}</p>
          }
        </div>

        <!-- Teléfono -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>phone</mat-icon>
            {{ 'projects.proposal.client_info.phone' | translate }}
          </label>
          <input type="tel" formControlName="ownerPhone" readonly
                 class="form-input readonly"
                 [placeholder]="'projects.proposal.client_info.phonePlaceholder' | translate">
        </div>

        <!-- Compañía -->
        <div class="form-group md:col-span-2">
          <label class="form-label">
            <mat-icon>business</mat-icon>
            {{ 'projects.proposal.client_info.company' | translate }}
          </label>
          <input type="text" formControlName="ownerCompany" readonly
                 class="form-input readonly"
                 [placeholder]="'projects.proposal.client_info.companyPlaceholder' | translate">
        </div>
      </div>
    </div>

    <!-- ========== UBICACIÓN DEL TRABAJO ========== -->
    <div class="form-section animate-fadeIn" style="animation-delay: 0.1s">
      <div class="section-header">
        <div class="section-icon green">
          <mat-icon>place</mat-icon>
        </div>
        <div class="flex-1">
          <h2>{{ 'projects.proposal.location.title' | translate }}</h2>
          <p>{{ 'projects.proposal.location.description' | translate }}</p>
        </div>

        <!-- Checkbox: Usar misma dirección que el cliente -->
        <label class="same-address-toggle" [class.active]="useSameAddress()" [class.disabled]="!proposalForm.get('ownerId')?.value">
          <input type="checkbox"
                 [checked]="useSameAddress()"
                 (change)="onUseSameAddressChange($any($event.target).checked)"
                 [disabled]="!proposalForm.get('ownerId')?.value">
          <mat-icon>home_work</mat-icon>
          <span>{{ 'projects.proposal.location.sameAsClient' | translate }}</span>
        </label>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Tipo de Trabajo -->
        <div class="form-group">
          <label class="form-label required">
            <mat-icon>business</mat-icon>
            {{ 'projects.proposal.project.type' | translate }}
          </label>
          <select formControlName="workType" class="form-input" [class.error]="shouldShowError('workType')">
            <option value="residential">{{ 'projects.proposal.project.residential' | translate }}</option>
            <option value="commercial">{{ 'projects.proposal.project.commercial' | translate }}</option>
          </select>
          @if (shouldShowError('workType')) {
            <p class="form-error">{{ 'projects.proposal.project.validation.typeRequired' | translate }}</p>
          }
        </div>

        <!-- Clasificación del Servicio -->
        <div class="form-group">
          <label class="form-label required">
            <mat-icon>construction</mat-icon>
            {{ 'projects.proposal.project.category' | translate }}
          </label>
          <select formControlName="jobCategory" class="form-input" [class.error]="shouldShowError('jobCategory')">
            <option value="">{{ 'projects.proposal.project.selectOption' | translate }}</option>
            <option value="remodeling">{{ 'projects.proposal.project.remodeling' | translate }}</option>
            <option value="plumbing">{{ 'projects.proposal.project.plumbing' | translate }}</option>
            <option value="services">{{ 'projects.proposal.project.services' | translate }}</option>
            <option value="equipment">{{ 'projects.proposal.project.equipment' | translate }}</option>
            <option value="new_construction">{{ 'projects.proposal.project.newConstruction' | translate }}</option>
          </select>
          @if (shouldShowError('jobCategory')) {
            <p class="form-error">{{ 'projects.proposal.project.validation.categoryRequired' | translate }}</p>
          }
        </div>

        <!-- Dirección del Trabajo -->
        <div class="form-group lg:col-span-3">
          <label class="form-label required">
            <mat-icon>location_on</mat-icon>
            {{ 'projects.proposal.location.address' | translate }}
          </label>
          <input type="text" formControlName="address"
                 class="form-input" [class.error]="shouldShowError('address')"
                 [placeholder]="'projects.proposal.location.addressPlaceholder' | translate">
          @if (shouldShowError('address')) {
            <p class="form-error">{{ 'projects.proposal.location.validation.addressRequired' | translate }}</p>
          }
        </div>

        <!-- Ciudad -->
        <div class="form-group">
          <label class="form-label required">
            <mat-icon>location_city</mat-icon>
            {{ 'projects.proposal.location.city' | translate }}
          </label>
          <input type="text" formControlName="city"
                 class="form-input" [class.error]="shouldShowError('city')"
                 [placeholder]="'projects.proposal.location.cityPlaceholder' | translate">
          @if (shouldShowError('city')) {
            <p class="form-error">{{ 'projects.proposal.location.validation.cityRequired' | translate }}</p>
          }
        </div>

        <!-- Estado -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>map</mat-icon>
            {{ 'projects.proposal.location.state' | translate }}
          </label>
          <input type="text" formControlName="state" class="form-input"
                 [placeholder]="'projects.proposal.location.statePlaceholder' | translate">
        </div>

        <!-- Código Postal -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>markunread_mailbox</mat-icon>
            {{ 'projects.proposal.location.zipCode' | translate }}
          </label>
          <input type="text" formControlName="zipCode" class="form-input"
                 [placeholder]="'projects.proposal.location.zipCodePlaceholder' | translate">
        </div>
      </div>
    </div>

    <!-- ========== FECHAS ========== -->
    <div class="form-section animate-fadeIn" style="animation-delay: 0.15s">
      <div class="section-header">
        <div class="section-icon purple">
          <mat-icon>event</mat-icon>
        </div>
        <div>
          <h2>{{ 'projects.proposal.dates.title' | translate }}</h2>
          <p>{{ 'projects.proposal.dates.description' | translate }}</p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Fecha del Estimado -->
        <div class="form-group">
          <label class="form-label required">
            <mat-icon>calendar_today</mat-icon>
            {{ 'projects.proposal.dates.estimateDate' | translate }}
          </label>
          <input type="date" formControlName="date" class="form-input">
          @if (proposalForm.get('date')?.invalid && proposalForm.get('date')?.touched) {
            <p class="form-error">La fecha es requerida</p>
          }
        </div>

        <!-- Válido Hasta -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>event_available</mat-icon>
            {{ 'projects.proposal.dates.validUntil' | translate }}
          </label>
          <input type="date" formControlName="validUntil" class="form-input">
        </div>
      </div>
    </div>

    <!-- ========== ITEMS INCLUIDOS ========== -->
    <div class="form-section animate-fadeIn" style="animation-delay: 0.2s">
      <div class="section-header">
        <div class="section-icon blue">
          <mat-icon>checklist</mat-icon>
        </div>
        <div>
          <h2>{{ 'projects.proposal.items.includedItems' | translate }}</h2>
          <p>{{ 'projects.proposal.items.includedItemsDescription' | translate }}</p>
        </div>
      </div>

      <!-- Alerta de validación -->
      @if (formSubmitted() && selectedCatalogItems().length === 0) {
        <div class="alert-error mb-4">
          <mat-icon>error</mat-icon>
          <div>
            <p class="font-bold">{{ 'projects.proposal.items.selectionRequired' | translate }}</p>
            <p class="text-xs mt-1">{{ 'projects.proposal.items.selectionRequiredMessage' | translate }}</p>
          </div>
        </div>
      }

      <!-- Dos Paneles -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">

        <!-- PANEL IZQUIERDO: Items Disponibles del Catálogo -->
        <div class="catalog-panel">
          <div class="catalog-panel-header">
            <div class="flex items-center justify-between mb-2">
              <h3>
                <mat-icon>inventory</mat-icon>
                {{ 'projects.proposal.catalog.title' | translate }} ({{ filteredCatalogItems().length }})
              </h3>
              <div class="flex items-center gap-2">
                <button type="button" class="btn-icon-sm blue" (click)="openCatalogManager()" title="Administrar catálogo">
                  <mat-icon>settings</mat-icon>
                </button>
                @if (filteredCatalogItems().length > 0) {
                  <button type="button" class="btn-text blue" (click)="addAllFilteredItems()">
                    <mat-icon>add_circle</mat-icon>
                    {{ 'projects.proposal.catalog.addAll' | translate }}
                  </button>
                }
              </div>
            </div>

            <!-- Búsqueda -->
            <div class="relative">
              <mat-icon class="input-icon-left-sm">search</mat-icon>
              <input type="text"
                     [value]="catalogSearchTerm()"
                     (input)="onCatalogSearchChange($event)"
                     [placeholder]="'projects.proposal.catalog.searchCatalog' | translate"
                     class="form-input-sm pl-8">
            </div>
          </div>

          <div class="catalog-items-list">
            @if (filteredCatalogItems().length === 0) {
              <div class="empty-catalog">
                <mat-icon>search_off</mat-icon>
                <p>{{ 'projects.proposal.catalog.noItems' | translate }}</p>
                <span>{{ 'projects.proposal.catalog.tryAnotherSearch' | translate }}</span>
              </div>
            } @else {
              @for (item of filteredCatalogItems(); track item.id) {
                <div class="catalog-item" (click)="addCatalogItemToProposal(item)">
                  <div class="flex-1 min-w-0">
                    <p class="item-name">{{ item.name }}</p>
                    @if (item.description) {
                      <p class="item-desc">{{ item.description }}</p>
                    }
                  </div>
                  <button type="button" class="item-add-btn">
                    <mat-icon>add_circle</mat-icon>
                  </button>
                </div>
              }
            }
          </div>
        </div>

        <!-- PANEL DERECHO: Items Seleccionados -->
        <div class="selected-panel">
          <div class="selected-panel-header">
            <div class="flex items-center justify-between">
              <h3>
                <mat-icon>checklist</mat-icon>
                {{ 'projects.proposal.catalog.selectedItems' | translate }} ({{ selectedCatalogItems().length }})
              </h3>
              @if (selectedCatalogItems().length > 0) {
                <button type="button" class="btn-text red" (click)="removeAllSelectedItems()">
                  <mat-icon>remove_circle</mat-icon>
                  {{ 'projects.proposal.catalog.removeAll' | translate }}
                </button>
              }
            </div>
          </div>

          <div class="selected-items-list">
            @if (selectedCatalogItems().length === 0) {
              <div class="empty-selected">
                <mat-icon>playlist_add</mat-icon>
                <p>{{ 'projects.proposal.catalog.noSelectedItems' | translate }}</p>
                <span>{{ 'projects.proposal.catalog.clickToAdd' | translate }}</span>
              </div>
            } @else {
              @for (item of selectedCatalogItems(); track item.id; let i = $index) {
                <div class="selected-item">
                  <div class="item-number">{{ i + 1 }}</div>
                  <div class="flex-1 min-w-0">
                    <p class="item-name">{{ item.name }}</p>
                    @if (item.description) {
                      <p class="item-desc">{{ item.description }}</p>
                    }
                  </div>
                  <button type="button" class="item-remove-btn" (click)="removeCatalogItemFromProposal(item.id)">
                    <mat-icon>remove_circle</mat-icon>
                  </button>
                </div>
              }
            }
          </div>
        </div>

      </div>

      <!-- Nota informativa -->
      <div class="info-note mt-4">
        <mat-icon>info</mat-icon>
        <p><strong>{{ 'projects.proposal.catalog.howToUse' | translate }}</strong> {{ 'projects.proposal.catalog.instructions' | translate }}</p>
      </div>
    </div>

    <!-- ========== EXTRAS NO INCLUIDOS ========== -->
    <div class="form-section animate-fadeIn" style="animation-delay: 0.25s"
         [class.extras-active]="includeExtrasSection()">
      <div class="section-header">
        <div class="section-icon" [class.amber]="includeExtrasSection()" [class.amber-light]="!includeExtrasSection()">
          <mat-icon>do_not_disturb_on</mat-icon>
        </div>
        <div class="flex-1">
          <h2>{{ 'projects.proposal.items.extrasNotIncluded' | translate }}</h2>
          <p>{{ 'projects.proposal.items.extrasDescription' | translate }}</p>
        </div>

        <!-- Toggle de activación -->
        <label class="extras-toggle" [class.active]="includeExtrasSection()">
          <input type="checkbox"
                 [checked]="includeExtrasSection()"
                 (change)="toggleExtrasSection($any($event.target).checked)">
          <div class="toggle-content">
            <span class="toggle-label">{{ includeExtrasSection() ? 'Sección Activada' : 'Activar Sección' }}</span>
            <span class="toggle-hint">{{ includeExtrasSection() ? 'Se incluirá en el estimado' : 'No se incluirá' }}</span>
          </div>
        </label>
      </div>

      <!-- Lista fija de extras -->
      <div class="extras-list">
        @for (extra of FIXED_EXTRAS; track $index; let i = $index) {
          <div class="extra-item" [class.active]="includeExtrasSection()">
            <div class="extra-number" [class.active]="includeExtrasSection()">{{ i + 1 }}</div>
            <p class="extra-text" [class.active]="includeExtrasSection()">{{ extra }}</p>
            @if (includeExtrasSection()) {
              <mat-icon class="extra-check">check</mat-icon>
            }
          </div>
        }
      </div>
    </div>

    <!-- ========== TOTALES ========== -->
    <div class="totals-section animate-fadeIn" style="animation-delay: 0.3s">
      <div class="section-header">
        <div class="section-icon blue-dark">
          <mat-icon>calculate</mat-icon>
        </div>
        <div>
          <h2>{{ 'projects.proposal.totals.title' | translate }}</h2>
          <p>{{ 'projects.proposal.totals.description' | translate }}</p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <!-- Subtotal -->
        <div class="form-group">
          <label class="form-label-light required">
            <mat-icon>payments</mat-icon>
            {{ 'projects.proposal.totals.subtotal' | translate }}
          </label>
          <div class="relative">
            <span class="input-prefix">$</span>
            <input type="number" formControlName="subtotal" min="0" step="0.01"
                   class="form-input-totals pl-8" [class.error]="shouldShowError('subtotal')"
                   placeholder="0.00">
          </div>
          @if (shouldShowError('subtotal')) {
            <p class="form-error-light">{{ 'projects.proposal.totals.subtotalRequired' | translate }}</p>
          }
        </div>

        <!-- Impuesto -->
        <div class="form-group">
          <label class="form-label-light">
            <mat-icon>percent</mat-icon>
            {{ 'projects.proposal.totals.taxPercent' | translate }}
          </label>
          <div class="relative">
            <input type="number" formControlName="taxPercentage" min="0" max="100" step="0.01"
                   class="form-input-totals pr-8" placeholder="0">
            <span class="input-suffix">%</span>
          </div>
        </div>

        <!-- Descuento -->
        <div class="form-group">
          <label class="form-label-light">
            <mat-icon>local_offer</mat-icon>
            {{ 'projects.proposal.totals.discountPercent' | translate }}
          </label>
          <div class="relative">
            <input type="number" formControlName="discountPercentage" min="0" max="100" step="0.01"
                   class="form-input-totals pr-8" placeholder="0">
            <span class="input-suffix">%</span>
          </div>
        </div>
      </div>

      <!-- Resumen de cálculos -->
      <div class="totals-summary">
        <div class="summary-row">
          <span>{{ 'projects.proposal.totals.subtotal' | translate }}:</span>
          <span class="value">{{ getSubtotal() | currencyFormatter }}</span>
        </div>

        @if (proposalForm.get('taxPercentage')?.value > 0) {
          <div class="summary-row">
            <span>{{ 'projects.proposal.totals.tax' | translate }} ({{ proposalForm.get('taxPercentage')?.value }}%):</span>
            <span class="value positive">+ {{ calculateTax() | currencyFormatter }}</span>
          </div>
        }

        @if (proposalForm.get('discountPercentage')?.value > 0) {
          <div class="summary-row">
            <span>{{ 'projects.proposal.totals.discount' | translate }} ({{ proposalForm.get('discountPercentage')?.value }}%):</span>
            <span class="value negative">- {{ calculateDiscount() | currencyFormatter }}</span>
          </div>
        }

        <div class="summary-divider"></div>

        <div class="summary-total">
          <span>{{ 'projects.proposal.totals.totalLabel' | translate }}</span>
          <span class="total-value">{{ calculateTotal() | currencyFormatter }}</span>
        </div>
      </div>
    </div>

    <!-- ========== NOTAS Y TÉRMINOS ========== -->
    <div class="form-section animate-fadeIn" style="animation-delay: 0.35s">
      <div class="section-header">
        <div class="section-icon slate">
          <mat-icon>notes</mat-icon>
        </div>
        <div>
          <h2>{{ 'projects.proposal.notes.title' | translate }}</h2>
          <p>{{ 'projects.proposal.notes.description' | translate }}</p>
        </div>
      </div>

      <div class="space-y-4">
        <!-- Notas Visibles -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>visibility</mat-icon>
            {{ 'projects.proposal.notes.clientNotes' | translate }}
          </label>
          <textarea formControlName="notes" rows="3" class="form-textarea"
                    [placeholder]="'projects.proposal.notes.clientNotesPlaceholder' | translate"></textarea>
        </div>

        <!-- Notas Internas -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>visibility_off</mat-icon>
            {{ 'projects.proposal.notes.internalNotes' | translate }}
          </label>
          <textarea formControlName="internalNotes" rows="3" class="form-textarea internal"
                    [placeholder]="'projects.proposal.notes.internalNotesPlaceholder' | translate"></textarea>
        </div>

        <!-- Términos y Condiciones -->
        <div class="form-group">
          <label class="form-label">
            <mat-icon>gavel</mat-icon>
            {{ 'projects.proposal.terms.title' | translate }}
          </label>
          <textarea formControlName="terms" rows="5" class="form-textarea"
                    [placeholder]="'projects.proposal.terms.placeholder' | translate"></textarea>
        </div>
      </div>
    </div>

    <!-- ========== BARRA DE ACCIONES STICKY ========== -->
    <div class="actions-bar animate-fadeIn" style="animation-delay: 0.4s">
      <div class="form-status">
        @if (proposalForm.invalid) {
          <mat-icon class="text-amber-500">warning</mat-icon>
          <span class="text-amber-600">{{ 'projects.proposal.validation.formIncomplete' | translate }}</span>
        } @else {
          <mat-icon class="text-green-500">check_circle</mat-icon>
          <span class="text-green-600">{{ 'projects.proposal.validation.formComplete' | translate }}</span>
        }
      </div>

      <div class="flex gap-2">
        <button type="button" class="btn-cancel" (click)="cancel()" [disabled]="isLoading()">
          <mat-icon>close</mat-icon>
          <span>{{ 'common.cancel' | translate }}</span>
        </button>

        <button type="button" class="btn-secondary" (click)="save(true)" [disabled]="isLoading()">
          @if (isLoading()) {
            <div class="btn-spinner"></div>
          } @else {
            <mat-icon>drafts</mat-icon>
          }
          <span>{{ 'common.saveDraft' | translate }}</span>
        </button>

        <button type="button" class="btn-primary" (click)="save(false)" [disabled]="isLoading()">
          @if (isLoading()) {
            <div class="btn-spinner"></div>
          } @else {
            <mat-icon>save</mat-icon>
          }
          <span>{{ isEditMode() ? ('projects.proposal.updateEstimate' | translate) : ('common.saveAndFinish' | translate) }}</span>
        </button>
      </div>
    </div>

  </form>

</div>
